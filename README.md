# リッチメニューエディタ（ブラウザ専用 + LINE API連携）

このプロジェクトは、React + TypeScript で作られたブラウザだけで動く「LINE リッチメニュー」エディタです。マーケターが視覚的にリッチメニューをデザインし、LINE Messaging API に渡すための JSON を出力できます。

さらに、Cloudflare Worker を使って直接 LINE API と連携し、リッチメニューの登録・画像アップロード・管理をブラウザから直接実行できます。

主な機能
- 外部画像（URL）またはローカル画像（JPEG/PNG）を背景として読み込み
- 画像のアップロード時にフォーマット／サイズ／アスペクト比／ファイルサイズの検証
- 画像上で矩形のタップ領域をドラッグで作成（または手動で数値入力）
- 領域の選択・移動・角ハンドル／中央ハンドルによるリサイズ
- 各領域にアクションを割り当て（URL / メッセージ / ポストバック / 日時選択 / リッチメニュー切り替え）
- 右側パネルで領域一覧とアクション編集、リアルタイムプレビュー
- JSON のプレビュー、クリップボードへコピー、JSON のダウンロード、既存 JSON のインポート
- **NEW!** LINE API連携（Cloudflare Worker経由）:
  - リッチメニューの作成と画像アップロードを一括実行
  - 既存リッチメニューの取得・削除
  - 既存リッチメニューをエディタで読み込んで再編集
  - 既存リッチメニューの画像を自動ダウンロード
  - デフォルトリッチメニューの設定
  - **テスト機能**: 特定ユーザーへのリッチメニューリンク

テンプレート
- Canva の LINE リッチメニューテンプレート（デザインの参考・素材）：
	https://www.canva.com/ja_jp/line-rich-menu/templates/

## Treasure Data 統合ガイド

Treasure Data の Audience Studio を使ってセグメント別にリッチメニューを配信する方法については、以下のガイドをご覧ください：

- 📘 [日本語ガイド](docs/TREASURE_DATA_INTEGRATION.md)
- 📗 [English Guide](docs/TREASURE_DATA_INTEGRATION_EN.md)

## セットアップと使い方

### ローカル開発

```bash
# 依存関係のインストール
npm install

# 開発サーバーを起動
npm run dev
```

ブラウザで http://localhost:5173 にアクセス

### 本番環境へのデプロイ

詳しくは [DEPLOYMENT.md](DEPLOYMENT.md) を参照してください。

**概要:**
1. Cloudflare Workerをデプロイ（サービス提供者が実施）
2. `.env`ファイルにWorker URLを設定
3. Web UIをビルド＆デプロイ（GitHub PagesまたはCloudflare Pages）

## LINE API 連携の使い方

### 基本的な使い方

1. 「LINE API連携」ボタンをクリック
2. **チャンネルアクセストークン**を入力
   - [LINE Developers Console](https://developers.line.biz/console/) から取得
   - 本番環境では、サービス提供のAPIエンドポイントが自動的に使用されます
3. 「リッチメニューを作成」をクリック → リッチメニューと画像が自動的に LINE に登録されます
4. 作成されたリッチメニューIDが表示されます。「コピー」ボタンでクリップボードにコピーできます
5. 「既存メニューを取得」で現在のリッチメニュー一覧を表示・管理

### 開発者モード（ローカルテスト）

ローカル環境でWorkerをテストする場合：

1. ローカルでWorkerを起動:
   ```bash
   cd worker
   npm run dev
   ```
2. Web UIで「開発者モード」チェックボックスを有効化
3. Worker URL に `http://localhost:8787` を入力
4. チャンネルアクセストークンを入力してテスト

### 既存のリッチメニューを編集

1. 「LINE API連携」を開き、「既存メニューを取得」をクリック
2. リッチメニュー一覧が表示されます
   - 各メニューのIDを「コピー」ボタンでクリップボードにコピー可能
3. 編集したいメニューの「エディタで開く」をクリック
4. メニュー情報と画像が自動的にエディタに読み込まれます（画像はLINE APIから自動ダウンロード）
5. 編集後、「リッチメニューを作成」で新しいリッチメニューとして保存
   - **注意**: LINEの仕様上、既存のリッチメニューの画像を直接更新することはできません
   - 画像を変更したい場合は、新しいリッチメニューとして作成し、古いメニューを削除してください

### テスト機能：特定ユーザーへのリンク

作成したリッチメニューを特定のユーザーにリンクしてテストできます：

1. 「LINE API連携」を開く
2. 「テスト機能：特定ユーザーへのリンク」セクションで：
   - **LINE User ID**: テスト対象ユーザーのUser IDを入力
   - **リッチメニューID**: リンクしたいリッチメニューのIDを入力
     - 「作成したIDを使用」ボタンで、直前に作成したIDを自動入力
3. 「ユーザーにリンク」をクリック
4. 対象ユーザーのLINEアプリでリッチメニューが表示されます

**User IDの確認方法:**
- LINE公式アカウントでユーザーからメッセージを受信
- WebhookのイベントからuserIdを取得

### セキュリティ

- チャンネルアクセストークンはブラウザの localStorage に保存されます（サーバーには送信されません）
- Cloudflare Worker はステートレスで、トークンを保存しません
- すべての通信は HTTPS で暗号化されます
- 本番環境では Worker 側で CORS の許可オリジンを制限することを推奨します

注意点・補足
- 画像アップロードは data URL を使ってブラウザの localStorage に一時保存します（容量制限に注意）。本番運用では CDN にアップロードして URL を指定する方法を推奨します。
- エディタでは便宜上 `imageUrl` を保存しますが、LINE の API が期待するフィールドではない場合があります（このフィールドはエディタへの再読み込み用の拡張です）。
- LINE API 連携を使わない場合は、生成された JSON を用いて、別途ご自身のサーバーやスクリプトから LINE Messaging API を呼び出すこともできます。

## プライバシーとデータの取り扱い

### データ保存について

**サービス提供者のサーバーには一切データを保存・記録しません。**

- すべての処理はブラウザ内（クライアントサイド）で完結します
- 入力されたデータ（画像、テキスト、設定など）は**ご利用のブラウザのlocalStorageにのみ保存**されます
- サービス提供者のサーバーには一切データを保存・記録しません
- Cloudflare Workerはステートレスなプロキシとして機能し、通信内容を保存・記録しません
- ブラウザのキャッシュをクリアすると、保存されたデータも削除されます

### チャンネルアクセストークンについて

- チャンネルアクセストークンは**ご利用のブラウザのlocalStorageにのみ保存**されます
- トークンはサービス提供者のサーバーには送信・保存されません
- トークンはCloudflare Workerを経由してLINE APIにのみ送信されます（Workerはトークンを保存しません）
- トークンはご自身で適切に管理してください
- 第三者と共有しないでください
- セキュリティのため、定期的に再生成することを推奨します

### 通信の安全性

- すべての通信はHTTPS経由で暗号化されます
- 通信経路: ブラウザ → Cloudflare Worker（プロキシ） → LINE API
- Cloudflare Workerは通信内容を保存・記録しません

## 免責事項

**本サービスは「現状有姿（AS IS）」で提供されます。以下の点に同意の上、ご利用ください。**

### 責任の範囲

- **サービスの利用により生じたいかなる損害**（データの損失、サービスの中断、セキュリティ上の問題、LINE APIの利用制限、アカウントの停止など）について、**サービス提供者は一切の責任を負いません**
- サービスの可用性、正確性、完全性、適時性、継続性について一切保証しません
- 予告なくサービスの内容を変更、または提供を中止する場合があります
- LINE Messaging APIの仕様変更により、予告なく機能が正常に動作しなくなる可能性があります
- 生成されたJSONやリッチメニューの正確性について保証しません。ご自身で内容を確認してください
- 本サービスの利用により第三者との間で生じたトラブルについて、一切の責任を負いません

### 利用者の責任

- 本サービスの利用は利用者ご自身の責任において行ってください
- LINEチャンネルの管理権限がある場合のみご利用ください
- チャンネルアクセストークンを第三者に開示・共有しないでください
- 生成されたリッチメニューの内容が適切かご自身で確認してください
- LINE公式アカウントの利用規約を遵守してください
- 本サービスを不正な目的で使用しないでください

### 推奨事項

- 重要なデータは必ずバックアップを取ってください
- **テスト環境（テスト用LINEチャンネル）で十分に動作確認してから本番環境で使用してください**
- チャンネルアクセストークンは定期的に再生成してください
- 本サービスで作成したリッチメニューは、公開前に必ず内容を確認してください
- 大切な既存のリッチメニューを削除する前に、JSONをバックアップしてください

### サービス提供について

本サービスは無償で提供されています。サービスの継続性、サポート、アップデートについて一切保証しません。

ライセンス

MITライセンスの下で提供されています。詳細はLICENSEファイルをご確認ください。
